# Results


``` {r}
## reading raw data from school year 2016 to 2019
## source:  https://www2.ed.gov/about/inits/ed/edfacts/data-files/index.html

# Long format
math20_21 <- read.csv("~/Desktop/STATGR-5702/final_project_local/math-achievement-lea-sy2020-21.csv")
rla20_21 <- read.csv("~/Desktop/STATGR-5702/final_project_local//rla-achievement-lea-sy2020-21.csv")

# wide format
math18_19 <- read.csv("~/Desktop/STATGR-5702/final_project_local//math-achievement-lea-sy2018-19-wide.csv")
rla18_19 <- read.csv("~/Desktop/STATGR-5702/final_project_local//rla-achievement-lea-sy2018-19-wide.csv")
math17_18 <- read.csv("~/Desktop/STATGR-5702/final_project_local//math-achievement-lea-sy2017-18.csv")
rla17_18 <- read.csv("~/Desktop/STATGR-5702/final_project_local//rla-achievement-lea-sy2017-18.csv")
math16_17 <- read.csv("~/Desktop/STATGR-5702/final_project_local//math-achievement-lea-sy2016-17.csv")
rla16_17 <- read.csv("~/Desktop/STATGR-5702/final_project_local//rla-achievement-lea-sy2016-17.csv")
math15_16 <- read.csv("~/Desktop/STATGR-5702/final_project_local//math-achievement-lea-sy2015-16.csv")
rla15_16 <- read.csv("~/Desktop/STATGR-5702/final_project_local//rla-achievement-lea-sy2015-16.csv")

library(dplyr)
library(tidyverse)
library(stringr) 
ny_math20_21 <- filter(math20_21, STNAM == "NEW YORK")
ny_rla20_21 <- filter(rla20_21, STNAM == "NEW YORK")
ny_20_21 <- rbind(ny_math20_21, ny_rla20_21)

ny_math18_19 <- filter(math18_19, STNAM == "NEW YORK")
ny_rla18_19 <- filter(rla18_19, STNAM == "NEW YORK")


ny_math17_18 <- filter(math17_18, STNAM == "NEW YORK")
ny_rla17_18 <- filter(rla17_18, STNAM == "NEW YORK")


ny_math16_17 <- filter(math16_17, STNAM == "NEW YORK")
ny_rla16_17 <- filter(rla16_17, STNAM == "NEW YORK")


ny_math15_16 <- filter(math15_16, STNAM == "NEW YORK")
ny_rla15_16 <- filter(rla15_16, STNAM == "NEW YORK")


## test  <- filter(ny_math18_19, ST_LEAID == 'NY-211003040000')
## test$ALL_MTH00numvalid_1819 <- as.character(test$ALL_MTH00numvalid_1819)




### ny_math 2018-19
ny_math18_19$ALL_MTH00numvalid_1819 <- as.character(ny_math18_19$ALL_MTH00numvalid_1819)

ny_math18_19_long <- pivot_longer(ny_math18_19, cols = 7:262 , 
                                  names_to = c("CATEGORY","v2", "SCHOOL_YEAR"), 
                                  names_sep = "_",
                                  values_to = "score")
ny_math18_19_long$SUBJECT <- str_sub(ny_math18_19_long$v2, 1,3) 
ny_math18_19_long$GRADE <- str_sub(ny_math18_19_long$v2, 4,5) 
ny_math18_19_long$score_type <- str_sub(ny_math18_19_long$v2, 6) 
ny_math18_19_long$score_type  = toupper(ny_math18_19_long$score_type)
ny_math18_19_long <- subset(ny_math18_19_long, select = -v2)

ny_math18_19_long <- pivot_wider(ny_math18_19_long, names_from = score_type,
                                 values_from = score )

### ny rla 2018-19
ny_rla18_19$ALL_RLA00numvalid_1819 <- as.character(ny_rla18_19$ALL_RLA00numvalid_1819)
ny_rla18_19_long <- pivot_longer(ny_rla18_19, cols = 7:262 , 
                                 names_to = c("CATEGORY","v2", "SCHOOL_YEAR"), 
                                 names_sep = "_",
                                 values_to = "score")
ny_rla18_19_long$SUBJECT <- str_sub(ny_rla18_19_long$v2, 1,3) 
ny_rla18_19_long$GRADE <- str_sub(ny_rla18_19_long$v2, 4,5) 
ny_rla18_19_long$score_type <- str_sub(ny_rla18_19_long$v2, 6) 
ny_rla18_19_long$score_type  = toupper(ny_rla18_19_long$score_type)
ny_rla18_19_long <- subset(ny_rla18_19_long, select = -v2)

ny_rla18_19_long <- pivot_wider(ny_rla18_19_long, names_from = score_type,
                                values_from = score )

### ny math 2017-18
ny_math17_18$ALL_MTH00NUMVALID_1718 <- as.character(ny_math17_18$ALL_MTH00NUMVALID_1718)

ny_math17_18_long <- pivot_longer(ny_math17_18, cols = 7:262 , 
                                  names_to = c("CATEGORY","v2", "SCHOOL_YEAR"), 
                                  names_sep = "_",
                                  values_to = "score")
ny_math17_18_long$SUBJECT <- str_sub(ny_math17_18_long$v2, 1,3) 
ny_math17_18_long$GRADE <- str_sub(ny_math17_18_long$v2, 4,5) 
ny_math17_18_long$score_type <- str_sub(ny_math17_18_long$v2, 6) 
ny_math17_18_long$score_type  = toupper(ny_math17_18_long$score_type)
ny_math17_18_long <- subset(ny_math17_18_long, select = -v2)

ny_math17_18_long <- pivot_wider(ny_math17_18_long, names_from = score_type,
                                 values_from = score )

### ny rla 2017-18
ny_rla17_18$ALL_RLA00NUMVALID_1718 <- as.character(ny_rla17_18$ALL_RLA00NUMVALID_1718)
ny_rla17_18_long <- pivot_longer(ny_rla17_18, cols = 7:262 , 
                                 names_to = c("CATEGORY","v2", "SCHOOL_YEAR"), 
                                 names_sep = "_",
                                 values_to = "score")
ny_rla17_18_long$SUBJECT <- str_sub(ny_rla17_18_long$v2, 1,3) 
ny_rla17_18_long$GRADE <- str_sub(ny_rla17_18_long$v2, 4,5) 
ny_rla17_18_long$score_type <- str_sub(ny_rla17_18_long$v2, 6) 
ny_rla17_18_long$score_type  = toupper(ny_rla17_18_long$score_type)
ny_rla17_18_long <- subset(ny_rla17_18_long, select = -v2)

ny_rla17_18_long <- pivot_wider(ny_rla17_18_long, names_from = score_type,
                                values_from = score )




### ny math 2016-17
ny_math16_17$ALL_MTH00NUMVALID_1617 <- as.character(ny_math16_17$ALL_MTH00NUMVALID_1617)

ny_math16_17_long <- pivot_longer(ny_math16_17, cols = 7:230 , 
                                  names_to = c("CATEGORY","v2", "SCHOOL_YEAR"), 
                                  names_sep = "_",
                                  values_to = "score")
ny_math16_17_long$SUBJECT <- str_sub(ny_math16_17_long$v2, 1,3) 
ny_math16_17_long$GRADE <- str_sub(ny_math16_17_long$v2, 4,5) 
ny_math16_17_long$score_type <- str_sub(ny_math16_17_long$v2, 6) 
ny_math16_17_long$score_type  = toupper(ny_math16_17_long$score_type)
ny_math16_17_long <- subset(ny_math16_17_long, select = -v2)

ny_math16_17_long <- pivot_wider(ny_math16_17_long, names_from = score_type,
                                 values_from = score )

### ny rla 2016-17
ny_rla16_17$ALL_RLA00NUMVALID_1617 <- as.character(ny_rla16_17$ALL_RLA00NUMVALID_1617)
ny_rla16_17_long <- pivot_longer(ny_rla16_17, cols = 7:230 , 
                                 names_to = c("CATEGORY","v2", "SCHOOL_YEAR"), 
                                 names_sep = "_",
                                 values_to = "score")
ny_rla16_17_long$SUBJECT <- str_sub(ny_rla16_17_long$v2, 1,3) 
ny_rla16_17_long$GRADE <- str_sub(ny_rla16_17_long$v2, 4,5) 
ny_rla16_17_long$score_type <- str_sub(ny_rla16_17_long$v2, 6) 
ny_rla16_17_long$score_type  = toupper(ny_rla16_17_long$score_type)
ny_rla16_17_long <- subset(ny_rla16_17_long, select = -v2)

ny_rla16_17_long <- pivot_wider(ny_rla16_17_long, names_from = score_type,
                                values_from = score )

### ny math 2015-16
ny_math15_16$ALL_MTH00NUMVALID_1516 <- as.character(ny_math15_16$ALL_MTH00NUMVALID_1516)
ny_math15_16_long <- pivot_longer(ny_math15_16, cols = 6:229 , 
                                  names_to = c("CATEGORY","v2", "SCHOOL_YEAR"), 
                                  names_sep = "_",
                                  values_to = "score")
ny_math15_16_long$SUBJECT <- str_sub(ny_math15_16_long$v2, 1,3) 
ny_math15_16_long$GRADE <- str_sub(ny_math15_16_long$v2, 4,5) 
ny_math15_16_long$score_type <- str_sub(ny_math15_16_long$v2, 6) 
ny_math15_16_long$score_type  = toupper(ny_math15_16_long$score_type)
ny_math15_16_long <- subset(ny_math15_16_long, select = -v2)

ny_math15_16_long <- pivot_wider(ny_math15_16_long, names_from = score_type,
                                 values_from = score )
ny_math15_16_long$ST_LEAID <- "NULL"

### ny rla 2015-16
ny_rla15_16$ALL_RLA00NUMVALID_1516 <- as.character(ny_rla15_16$ALL_RLA00NUMVALID_1516)
ny_rla15_16_long <- pivot_longer(ny_rla15_16, cols = 6:229 , 
                                 names_to = c("CATEGORY","v2", "SCHOOL_YEAR"), 
                                 names_sep = "_",
                                 values_to = "score")
ny_rla15_16_long$SUBJECT <- str_sub(ny_rla15_16_long$v2, 1,3) 
ny_rla15_16_long$GRADE <- str_sub(ny_rla15_16_long$v2, 4,5) 
ny_rla15_16_long$score_type <- str_sub(ny_rla15_16_long$v2, 6) 
ny_rla15_16_long$score_type  = toupper(ny_rla15_16_long$score_type)
ny_rla15_16_long <- subset(ny_rla15_16_long, select = -v2)

ny_rla15_16_long <- pivot_wider(ny_rla15_16_long, names_from = score_type,
                                values_from = score )
ny_rla15_16_long$ST_LEAID <- "NULL"

#### combining all data 
ny_edu <- rbind(ny_20_21, 
                ny_math18_19_long, ny_rla18_19_long,
                ny_math17_18_long, ny_rla17_18_long,
                ny_math16_17_long, ny_rla16_17_long,
                ny_math15_16_long, ny_rla15_16_long)



#### note: after dowloading and reading the file follow from here:

ny_edu <- 
  ny_edu %>%
  separate(PCTPROF, c("num1", "num2"), "-|LE|LT|GT|GE", remove =FALSE)

## TODO: viz to show how many unreported scores we have
# ny_edu_ps <- filter(ny_edu, PCTPROF == "PS")

## data without PS
# ny_edu_cl <- filter(ny_edu, PCTPROF != "PS")

### we don't remove NAs for furthur analysis of missing values
## ny_edu_cl <- filter(ny_edu_cl, !is.na(NUMVALID))

ny_edu$num1 <- as.numeric(ny_edu$num1)
ny_edu$num2 <- as.numeric(ny_edu$num2)
ny_edu$avg_num<- (ny_edu$num1 + ny_edu$num2) /2

ny_edu$PASSED <- coalesce(ny_edu$avg_num, ny_edu$num1, ny_edu$num2)

ny_edu <- subset(ny_edu, select = -c(num1, num2, avg_num))

ny_edu <- 
ny_edu %>%
  mutate(
    CATEGORY_DESC = case_when(
      CATEGORY == "CWD" ~ "Children with disabilities ",
      CATEGORY == "ECD" ~ "Economically disadvantaged",
      CATEGORY == "F" ~ "Female",
      CATEGORY == "FCS" ~ "Foster Care Status",
      CATEGORY == "HOM" ~ "Homeless Enrolled",
      CATEGORY == "LEP" ~ "English Learner",
      CATEGORY == "M" ~ "Male",
      CATEGORY == "MAM" ~ "American Indian/Alaska Native",
      CATEGORY == "MAS" ~ "Asian/Pacific Islander",
      CATEGORY == "MBL" ~ "Black",
      CATEGORY == "MHI" ~ "Hispanic",
      CATEGORY == "MIG" ~ "Migrant",
      CATEGORY == "MIL" ~ "Military Connected Student Status",
      CATEGORY == "MTR" ~ "Two or More Races",
      CATEGORY == "MWH" ~ "White",
      CATEGORY == "ALL" ~ "ALL"
    )
  )

ny_edu <- 
  ny_edu %>%
  mutate(
    CATEGORY_TPYE = case_when(
      CATEGORY == "CWD" | CATEGORY == "FCS" | CATEGORY == "HOM"
        | CATEGORY == "ECD" | CATEGORY == "LEP"  | CATEGORY == "MIG" 
        | CATEGORY == "MIL" ~ "Special Status" ,
      CATEGORY == "F" | CATEGORY == "M" ~ "Sex",
      CATEGORY == "MAM" |
      CATEGORY == "MAS" |
      CATEGORY == "MBL" |
      CATEGORY == "MHI" |
      CATEGORY == "MTR" |
      CATEGORY == "MWH" ~ "Race/Ethnicity",
      CATEGORY == "ALL" ~ "ALL"
    )
  )



ny_edu <- 
  ny_edu %>%
  mutate(
    SCHOOL_YEAR = case_when(
      SCHOOL_YEAR == '2020-2021' ~ "2020-21",
      SCHOOL_YEAR == '1819' ~ "2018-19",
      SCHOOL_YEAR == '1718' ~ "2017-18",
      SCHOOL_YEAR == '1617' ~ "2016-17",
      SCHOOL_YEAR == '1516' ~ "2015-16",
    )
  )

ny_edu <- 
  ny_edu %>%
  mutate(
    GRADE = case_when(
      GRADE == "00" ~ "ALL",
      TRUE ~ GRADE))

ny_edu <- 
  ny_edu %>% 
    rename( "District" = "LEANM")

ny_edu_final <- subset(ny_edu, select = -c(STNAM, LEAID, ST_LEAID, DATE_CUR))
ny_edu_final$NUMVALID <- as.numeric(ny_edu_final$NUMVALID)
ny_edu_final$CATEGORY <- as.factor(ny_edu_final$CATEGORY)
```



## Demographics 
In this section we will explore the reported demographics and population distribution of NY students. We look for any anomalies, highlight trends and point out any consideration we might need to have before moving forward to review proficiency results. 

<br>


```{r}
options(scipen = 999)
ny_edu_final |>
  filter(GRADE == "ALL", CATEGORY == "ALL") |>
  group_by(SCHOOL_YEAR, SUBJECT) |>
  summarise(Students_Count = sum(NUMVALID)/1000) |>
  
  ggplot(aes(x = SCHOOL_YEAR, y = Students_Count, fill = SUBJECT))+
  geom_bar(stat = "identity", position = "dodge")+
  ggtitle('Students Assessed for Math and RLA in NY State')+
  labs(x='School Year', y='Number of Students in Thousands')+
  theme_bw(13)+
  scale_fill_brewer(palette="Paired")
```

**why is there a drop in 2020-21 student count?**

The number of reported students for both Math and RLA assessments are relatively steady year over year from 2015-16 to 2018-19 school years, but we observe a sharp drop in 2020-21 school year. Also, we can observe that the data was not reported for the 2020-21 school year. Upon investigating the Department of Education, we have noticed that the reporting requirements were waived for 2020 and were relaxed for 2021 reporting due to the circumstances of COVID-19 pandemic. This is an important consideration when we analyze the latest school year.
This is outlined on the US Department of Education website:
https://www2.ed.gov/about/inits/ed/edfacts/data-files/index.html

***
<br>

```{r}
####### numbers by grade
ny_edu_final |>
  filter( GRADE != "ALL", SUBJECT == "MTH") |>
  group_by(GRADE, SUBJECT, SCHOOL_YEAR) |>
  summarise(Students_Count = sum(NUMVALID/1000, na.rm=TRUE)) |>
  
  ggplot(aes(x = GRADE, y = Students_Count))+
  geom_bar(stat = "identity", fill ="#1f78b4")+
  facet_wrap(~SCHOOL_YEAR)+
  ggtitle('Students Assessed for Math and RLA in NY State')+
  labs(x='Grade', y='Number of Students in Thousands')+
  theme_bw(13)+
  scale_fill_brewer(palette="Paired")

```

**Is 2020-21 school year data underreported for all grades?**

We can observe from the chart that in the 2020-21 school year the high school reported numbers are aligned with previous years but the third through eighth grade were significantly underreported compared to the previous years. The reason for this is not totally clear to us but one interesting fact that we will review in the next section is that generally high schools have better ratios of proficiency assessment results. One theory could be that since the results are better the districts have reported these numbers more compared to the other grades. Another interesting demographic observation is that there are almost always less students in seventh and eighth grades compared to other grades. This is another observation that needs to be discussed with a subject matter expert on this topic. 

***
<br>

``` {r}
### students by status
ny_edu_final |>
  filter( GRADE == "ALL", SUBJECT == "MTH", CATEGORY != "ALL", CATEGORY_TPYE == "Special Status") |>
  group_by(CATEGORY) |>
  summarise(Students_Count = sum(coalesce(NUMVALID, 0) )) |>
  ungroup() |>
  group_by() |>
  mutate(total = round((Students_Count/sum(Students_Count, na.rm=TRUE)),4)*100 ) |>
  ggplot(aes(x = reorder(CATEGORY, -total), y = total ))+
  geom_bar(stat = "identity", fill ="#1f78b4")+
  #facet_wrap(~SCHOOL_YEAR)+
  ggtitle('Distribution of New York Stduents by Status (2015-2021)')+
  labs(x='Status Type', y='Percentage')+
  theme_bw(13)+
  scale_fill_brewer(palette="Paired")+
  geom_text(aes(label=total), position=position_dodge(width=0.9), vjust=-0.25)+
  annotate("label", x=5.5, y=50, 
    label= 
"ECD: Economically disadvantaged 
CWD: Children with disabilities
LEP: English Learner
HOM: Homeless Enrolled
FCS: Foster Care Status
MIG: Migrant
MIL: Military Connected Student Status")

```

**What is the distribution of students with reported special status?**

We can observe that almost 65% of the students with special status are from Economically disadvantaged categories. We cannot directly compute what percentage of the whole population of students fall into this category. It’s also not clear if there is any overlap in categories. It’s notable to mention that less than 0.3% of students with special status fall into Foster care, Migrant, or with Military connected status.

***
<br>

```{r}
### students by Gender
ny_edu_final |>
  filter( GRADE == "ALL", SUBJECT == "MTH", CATEGORY != "ALL", CATEGORY_TPYE == "Sex") |>
  group_by(CATEGORY) |>
  summarise(Students_Count = sum(NUMVALID, na.rm=TRUE)) |>
  ungroup() |>
  group_by() |>
  mutate(total = round((Students_Count/sum(Students_Count)),2) ) |>
  
  ggplot(aes(x = reorder(CATEGORY, -total), y = total ))+
  geom_bar(stat = "identity", fill ="#1f78b4")+
  #facet_wrap(~SCHOOL_YEAR)+
  ggtitle('Distribution of New York Stduents by Sex (2015-2021)')+
  labs(x='Sex', y='Percentage')+
  theme_bw(13)+
  scale_fill_brewer(palette="Paired")+
  geom_text(aes(label=total), position=position_dodge(width=0.9), vjust=-0.25)

```

**What is the distribution of students by who they identified (female / male)?**

As expected the distribution is pretty even with slightly more students who identified as male with 52% and 48% who identified as female.

***
<br>
```{r}

### students by race
ny_edu_final |>
  filter( GRADE == "ALL", SUBJECT == "MTH", CATEGORY != "ALL", CATEGORY_TPYE == "Race/Ethnicity") |>
  group_by(CATEGORY) |>
  summarise(Students_Count = sum(NUMVALID, na.rm=TRUE)) |>
  ungroup() |>
  group_by() |>
  mutate(total = round((Students_Count/sum(Students_Count)),2) ) |>
  
  ggplot(aes(x = reorder(CATEGORY, -total), y = total ))+
  geom_bar(stat = "identity", fill ="#1f78b4")+
  #facet_wrap(~SCHOOL_YEAR)+
  ggtitle('Distribution of New York Stduents by Race/Ethnicity (2015-2021)')+
  labs(x='Race/Ethnicity', y='Percentage')+
  theme_bw(12)+
  scale_fill_brewer(palette="Paired")+
  geom_text(aes(label=total), position=position_dodge(width=0.9), vjust=-0.25)+
  annotate("label", x=4.5, y=.35, 
           label= 
 
"MWH: White
MHI: Hispanic
MBL: Black
MAS: Asian/Pacific Islander
MTR: Two or more races
MAM: American Indian/Alaska Native")

```

**What is the distribution of students by race / ethnicity?**

A notable observation is that NY state has a significantly higher ratio of non-white students compared to US national averages. Per government census around 76% of the US population is white while in NY the ratio of white students is 43%.

Source:

https://www.census.gov/quickfacts/fact/table/US/PST045221

***
<br>
```{r}

```

